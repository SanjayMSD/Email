name: Google Drive Loader with Env Detection

on:
  workflow_dispatch:   # manual trigger
  schedule:
    - cron: "0 1/6 * * *"  # every 6 hours

jobs:
  run:
    runs-on: ubuntu-latest

    steps:
      # ğŸ§­ 1. Checkout your repo
      - name: Checkout repository
        uses: actions/checkout@v4

      # ğŸ 2. Setup Python
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.10"

      # ğŸ“¦ 3. Install dependencies
      - name: Install dependencies
        run: |
          pip install pandas openpyxl pydrive2 beautifulsoup4 requests

      # ğŸš€ 4. Run your Python script
      - name: Run Drive Loader
        env:
          GOOGLE_CREDENTIALS: ${{ secrets.GOOGLE_CREDENTIALS }}
        run: |
          python 1_Read_Google_Drive_In_GitHub_Actions.py

      # ğŸ’¾ 5. Commit & push updated Excel files back to repo
      - name: Commit and push results
        if: always()   # run even if previous step fails
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "actions@github.com"
          git add Website_Emails.xlsx Not_Accessible_Websites.xlsx Dataset_M10_D20.xlsx || echo "No files to add"
          git commit -m "ğŸ”„ Auto-update: website scan results [$(date)]" || echo "No changes to commit"
          git push origin HEAD:${{ github.ref }} || echo "No changes to push"
